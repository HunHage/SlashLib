package net.exploitables.slashlib.commands;

import discord4j.core.spec.EmbedCreateSpec;
import discord4j.core.spec.InteractionApplicationCommandCallbackSpec;
import net.exploitables.slashlib.context.SlashCommandContext;
import net.exploitables.slashlib.context.SlashCommandContextBuilder;
import reactor.core.publisher.Mono;

/**
 * A command that requires a permission to be set to be called.
 */
public class ModPermNeeded extends TopCommand {
    public ModPermNeeded() {
        super("modpermneeded", "a command that needs the moderator role permission to be set with /setmodrole");
        setDefaultPermissionFalse();
    }

    @Override
    public Mono<SlashCommandContext> executeChat(SlashCommandContext context) {
        return context.getEvent()
            .reply(
                InteractionApplicationCommandCallbackSpec.builder()
                    .addEmbed(EmbedCreateSpec.builder()
                        .author(
                            context.getMember().getDisplayName() +
                                "`ID:" + context.getMember().getId().asString() + "`",
                            null,
                            context.getMember().getAvatarUrl())
                        .title(context.getGuild().getName() + "`ID:" + context.getGuild().getId().asString() + "`")
                        .description(
                            context.getGuildChannel().getName() +
                                "`ID:" + context.getGuildChannel().getId().asString() + "`")
                        .build())
                    .build())
            .thenReturn(context);
    }

    @Override
    public SlashCommandContextBuilder setRequestData(SlashCommandContextBuilder context) {
        return context.requireGuild().requireGuildChannel().requireMember();
    }
}
