package net.exploitables.slashlib.examples.BasicUsage;

import discord4j.core.DiscordClient;
import discord4j.core.GatewayDiscordClient;
import discord4j.core.event.EventDispatcher;
import net.exploitables.slashlib.SlashLib;
import net.exploitables.slashlib.commands.BaseCommand;
import net.exploitables.slashlib.commands.EchoCommand;
import net.exploitables.slashlib.commands.PingCommand;
import net.exploitables.slashlib.commands.TopLevelGroup;

import java.util.ArrayList;
import java.util.List;
import java.util.Objects;

public class ExampleBasicUsage {
    public static void main(String[] args) {
        // Setup Discord4J
        DiscordClient client = DiscordClient.create(args[0]);
        EventDispatcher dispatcher = EventDispatcher.builder().build();

        // Setup Commands and SlashLib
        List<BaseCommand> commands = new ArrayList<>();
        commands.add(new PingCommand());
        commands.add(new EchoCommand());
        commands.add(new TopLevelGroup());
        SlashLib slashLib = SlashLib.create(commands);
        slashLib.registerAsListener(dispatcher);

        // Login to discord
        GatewayDiscordClient gateway = client.gateway()
            .setEventDispatcher(dispatcher)
            .login()
            .block();

        // Register Slash Commands
        Long applicationId = client.getApplicationId().block();
        Objects.requireNonNull(applicationId);
        slashLib.getCommandRegister().registerSlashCommands(client.getApplicationService(), applicationId);

        // Block until disconnect
        //noinspection ConstantConditions
        gateway.onDisconnect().block();
    }
}
